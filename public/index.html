<!doctype html>
<html lang="en">
  <head>
    <title>EWU iCal Generator</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css" />
  </head>

  <body>
    <h1>EWU iCal Generator</h1>

    <div id="root">Loading...</div>

    <script type="module">
      import { html, render } from "//unpkg.com/lighterhtml?module";

      const root = document.getElementById("root");

      const fetchCalendars = async () => {
        return fetch("/api/calendars").then((res) => res.json());
      };

      const calendars = await fetchCalendars().catch((e) => {
        render(
          root,
          html`<p>Couldn't get calendars :-( <br />(${e.message})</p>`,
        );
      });

      const doc = html`<div>
        ${calendars.map(
          (cal) =>
            html`<h2>${cal.year}</h2>
              ${cal.programs.map(
                (program) =>
                  html`<details>
                    <summary>${program.program_type}</summary>
                    <ul>
                      ${program.calendars.map(
                        (calendar) =>
                          html`<li>
                            <a href="/info.html?calendar_path=${calendar.url}"
                              >${calendar.name}</a
                            >
                          </li>`,
                      )}
                    </ul>
                  </details>`,
              )}`,
        )}
      </div>`;

      render(root, doc);
    </script>
  </body>
</html>
